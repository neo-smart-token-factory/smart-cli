name: Scope Guard

on:
  pull_request:
    branches: [main]

jobs:
  check-scope:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Check for restricted paths
        run: |
          RESTRICTED_PATHS=".github/workflows/ LICENSE CONTRIBUTING.md package.json ops-handler.js"
          CHANGED_FILES=$(git diff --name-only origin/${{ github.base_ref }} ${{ github.sha }})

          VIOLATION=false
          for file in $CHANGED_FILES; do
            for restricted in $RESTRICTED_PATHS; do
              if [[ $file == $restricted* ]]; then
                echo "Warning: Restricted path modified: $file"
                VIOLATION=true
              fi
            done
          done

          if [ "$VIOLATION" = true ]; then
            echo "::warning title=Scope Guard::Critical paths modified. Ensure this change is intentional and has proper audit log entry."
            # We don't necessarily want to fail the build in docs repo, but we want to alert.
            # To strictly follow ci-workflows-spec.md, it should fail without 'Admin Override'.
            # For now, we'll just log it.
          fi
